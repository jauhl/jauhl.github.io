<!doctype html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Schubschleife</title>      
</head>

<body>
    <h2>Schubschleife - Grundfall 1</h2>             
    <canvas id="c" width="500" height="400" style="border-width:1px;border-style:solid"></canvas>
    <br>
    <label for="sslider">s:
    <input type="range" id="sslider" style="width:450px;vertical-align:middle;padding:0" min="-200" max="200" value="0">
    <output id="sout" for="sslider">0</output>mm
    </label>
     
    <script src="https://gitcdn.xyz/repo/goessner/g2/master/g2.min.js"></script>
    <script src="https://gitcdn.xyz/repo/goessner/g2-mec/master/g2.mec.min.js"></script>    

    <script>

var cnv = document.getElementById('c'),
    ctx = cnv.getContext('2d'),
    sslider = document.getElementById('sslider'),
    sout = document.getElementById('sout'), 

    s = 0, // Laufvariable

    mec = {
        h: 150,
        l: 280,
        get g() { return {x:-s, y:h}; },
        get b() { return Math.sqrt(this.h*this.h + s*s); },
        get psi() { return Math.atan2(this.h/this.b, -s/this.b); },
        get epsi() { return {x:Math.cos(this.psi), y:Math.sin(this.psi)}; },

        // Gelenkpunkte
        get A() { return {x:s, y:0}; },
        get B() { return { x:0, y:this.h }; },
        get C() { return { x:this.A.x + this.l*this.epsi.x, y:this.A.y + this.l*this.epsi.y }; } 
    },  
 
    g = g2(),

    // baut und initialisiert statische Umgebung
    world = g2().clr().cartesian()
                .pan(250, 100) // Nullpunkt verschoben   
                .use(g)
                .use("nodfix", mec.B),

    dirty = true  // wenn true gibt es was zu aktualisieren
    ;

function position() {
    g.del()
     .bar(mec.A, mec.C)
     .slider(mec.B, mec.psi, {fs:"@nodfill"})
     .use("nodflt", mec.A)
     .use("nod", mec.C)
}        

function render() {
    if (dirty) {
        position();  // aktualisiere Position
        world.exe(ctx);  // rendert world in den Context
        dirty = false;
    }
    requestAnimationFrame(render);  // asynchroner callback von render(), keine Rekursion!
}

function sets() {
    if (sslider.value != sout.value) {
        s = +sslider.value;
        sout.innerHTML = sslider.value;
        dirty = true;
    }
}

/*
 *  Initialisierung
 */

// Eventlistener hinzufuegen
sslider.addEventListener("input",sets);

// Animation starten
render();

    </script>
</body>
</html>
