<!doctype html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Pendelrolle</title>      
</head>

<body>
    <h2>Pendel</h2>             
    <canvas id="c" width="600" height="400" style="border-width:1px;border-style:solid"></canvas>
  
    <script src="https://gitcdn.xyz/repo/goessner/g2/master/g2.min.js"></script>
    <script src="https://gitcdn.xyz/repo/goessner/g2-mec/master/g2.mec.min.js"></script>    

    <script>

var cnv = document.getElementById('c'),
    ctx = cnv.getContext('2d'),

    pi = Math.PI
    g = 9.81,
    t0 = false,

    l = 200, 
    R = 50,

    T = 2, // Periodendauer [s]
    omega = (2*pi)/T, 
    Amplitude = pi/2,
    
    phi = 0,
    phi_0 = (3/2)*pi,  // normalnull zeigt nach rechts, daher 3/4 versatz mathem. positiv 

    mec = {
        get ephi() { return {x:Math.cos(phi), y:Math.sin(phi) }; },
        get A()    { return {x:l*this.ephi.x, y:l*this.ephi.y, w:-phi*l/R}; }
    },

    pipe = [];  // Array aus Punkten zur Definition von .ground

buildpipe();  // muss hier ausgef√ºhrt werden weil sonst pipe leer wenn world gebaut wird
 
var Pendel = g2(),
    world = g2().clr().cartesian()
                .pan(300, 300) // Nullpunkt verschoben
                .use(Pendel)
                .use("nodfix", {x:0, y:0, w:pi})
                .ground(pipe, false, {h:10})
    ;

function position(t) {
    phi = Amplitude*Math.sin(omega*t) + phi_0;

    Pendel.del()
          .bar({x:0, y:0}, mec.A)    
          .pulley2(mec.A, R)  // phi*l/R aus Haftbedingung
          .use("nod", mec.A)
}        

function render(time) {
    if (!t0)
        t0 = time;
    position((time-t0)/1000);
    world.exe(ctx); 
    requestAnimationFrame(render);
}

function buildpipe() {
    for (i = 180; i <= 360; i++) {
        pipe.push((l+R)*Math.cos(i*pi/180), (l+R)*Math.sin(i*pi/180))  // flatarray x,y wird gepusht
    }
}

requestAnimationFrame(render);

    </script>
</body>
</html>
