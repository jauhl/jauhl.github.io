<!doctype html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Kurbel</title>      
</head>

<body>
    <h2>Kurbel</h2>             
    <canvas id="c" width="300" height="300" style="border-width:1px;border-style:solid"></canvas>
    <br>
    <label for="phislider">&phi;:
    <input type="range" id="phislider" style="width:240px;vertical-align:middle;padding:0" min="0" max="360" value="0">
    <output id="phiout" for="phislider">0</output>Â°
    </label>
    <br>
    <label for="lslider">l:
    <input type="range" id="lslider" style="width:240px;vertical-align:middle;padding:0" min="20" max="150" value="100">
    <output id="lout" for="lslider">100</output>mm
    </label>
  
    <script src="https://gitcdn.xyz/repo/goessner/g2/master/g2.min.js"></script>
    <script src="https://gitcdn.xyz/repo/goessner/g2-mec/master/g2.mec.min.js"></script>    

    <script>

var cnv = document.getElementById('c'),
    ctx = cnv.getContext('2d'),
    phislider = document.getElementById('phislider'),
    phiout = document.getElementById('phiout'),
    lslider = document.getElementById('lslider'),
    lout = document.getElementById('lout'),    

    pi = Math.PI,
    l = 100,  // Laenge der Kurbel


    phi = 0, // Laufvariable

    mec = {
        get ephi() { return {x:Math.cos(phi), y:Math.sin(phi)}; },
        get A() { return {x:l*mec.ephi.x, y:l*mec.ephi.y}; }
    },  
 
    Kurbel = g2(),  // definiert Kurbel als g2() Objekt

    // baut und initialisiert statische Umgebung
    world = g2().clr().cartesian()
                .pan(150, 150) // Nullpunkt verschoben   
                .use(Kurbel)
                .use("nodfix"),

    dirty = true  // wenn true gibt es was zu aktualisieren
    ;

function position() {
    // baut dynamische Kurbel auf
    Kurbel.del()
          .lin(0, 0, mec.A.x, mec.A.y, {lw:3})
          .use("nod", mec.A);
}        

function render() {
    if (dirty) {
        position();  // aktualisiere Position
        world.exe(ctx);  // rendert world in den Context
        dirty = false;
    }
    requestAnimationFrame(render);  // asynchroner callback von render(), keine Rekursion!
}

function setPhi() {
    if (phislider.value != phiout.value) {
        phi = phislider.value*pi/180;
        phiout.innerHTML = phislider.value;
        dirty = true;
    }
}

function setl() {
    if (lslider.value != lout.value) {
        l = lslider.value;
        lout.innerHTML = lslider.value;
        dirty = true;
    }
}

/*
 *  Initialisierung
 */

// Eventlistener hinzufuegen
phislider.addEventListener("input",setPhi);
lslider.addEventListener("input",setl);  // bei hohem Rechenaufwand ist "change" sinnvoller


// Animation starten
render();

    </script>
</body>
</html>
