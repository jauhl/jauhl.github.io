<!doctype html>
<html>
<head>
    <meta charset='utf-8'>
    <title>labeljump</title>      
</head>

<body>
    <h2>labeljump @ &phi; = n*&pi;/2</h2>             
    <canvas id="c" width="300" height="300" style="border-width:1px;border-style:solid"></canvas>
    <br>
    <label for="phislider">&phi;:
    <input type="range" id="phislider" style="width:240px;vertical-align:middle;padding:0" min="0" max="360" value="0">
    <output id="phiout" for="phislider">0</output>Â°
    </label>
  
    <script src="https://gitcdn.xyz/repo/goessner/g2/master/g2.min.js"></script>
    <script src="https://gitcdn.xyz/repo/goessner/g2-mec/master/g2.mec.min.js"></script>    

    <script>

var cnv = document.getElementById('c'),
    ctx = cnv.getContext('2d'),
    phislider = document.getElementById('phislider'),
    phiout = document.getElementById('phiout'),

    pi = Math.PI,

    mec = {
        phi:0,
        l:100,
        origin:{x:0 ,y:0},
        get A() { return {x:this.l*Math.cos(this.phi), y:this.l*Math.sin(this.phi)}; },
        get B() { return {x:this.l*Math.cos(this.phi - 45*pi/180), y:this.l*Math.sin(this.phi - 45*pi/180)}; }
    },  
 
    crank = g2(),

    world = g2().clr().cartesian()
                .pan(150, 150) 
                .use(crank)
                .use("nodfix"),

    dirty = true
    ;

function position() {
    crank.del()
         .lin(0, 0, mec.A.x, mec.A.y)
           .label("lin","mid","left")
         .ply([0, 0, mec.B.x, mec.B.y])
           .label("ply",0.5,"right")
}        

function render() {
    if (dirty) {
        position();
        world.exe(ctx);
        dirty = false;
    }
    requestAnimationFrame(render);
}

function setPhi() {
    if (phislider.value != phiout.value) {
        mec.phi = phislider.value*pi/180;
        phiout.innerHTML = phislider.value;
        dirty = true;
    }
}

phislider.addEventListener("input",setPhi);
render();

    </script>
</body>
</html>
