<!doctype html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Kurbel</title>
</head>

<body>
    <h2>Kurbel</h2>
    <canvas id="c" width="300" height="300" style="border-width:1px;border-style:solid"></canvas>
    <br>
    <button id="b">Start/Stop</button>
    <br><br>
    <label for="speed">Geschwindigkeit:</label>
    <select id="speed">
        <option value="0.5">0,5x</option>
        <option value="1" selected>1x</option>
        <option value="2">2x</option>
        <option value="4">4x</option>
    </select>
    <br>
    <output id="Periodendauer" for="speed">T: 6s</output>
    <br><br>
    <input type="checkbox" id="direction" >
    <label for="direction"> Drehrichtung umkehren</label>
    <br><br>
    <label for="lslider">l:
    <input type="range" id="lslider" style="width:240px;vertical-align:middle;padding:0" min="20" max="150" value="100">
    <output id="lout" for="lslider" >100</output>mm
    </label>

    <script src="https://gitcdn.xyz/repo/goessner/g2/master/src/g2.js"></script>
    

    <script>

let cnv = document.getElementById('c'),
    ctx = cnv.getContext('2d'),
    b = document.getElementById('b'),
    speed = document.getElementById('speed'),
    Periodendauer = document.getElementById('Periodendauer'),
    Drehrichtung = document.getElementById('direction'),
    lslider = document.getElementById('lslider'),
    lout = document.getElementById('lout'),

    pi = Math.PI,
    l = 100,  // Laenge der Kurbel


    phi = 0, // Laufvariable
    speedmod = 1,  // Faktor der die Geschwindigkeit modifiziert

    mec = {
        get ephi() { return {x:Math.cos(phi), y:Math.sin(phi)}; },
        get A() { return {x:l*mec.ephi.x, y:l*mec.ephi.y}; }
    },

    Kurbel = g2(),  // definiert Kurbel als g2() Objekt

    // baut und initialisiert statische Umgebung
    world = g2().clr().view({x:150,y:150,cartesian:true})
                .use({grp:Kurbel})
                .nodfix(),

    run = true  // Boolean als Schalter um zu pruefen ob Animation laeuft
    ;

function position() {
    // baut dynamische Kurbel auf
    Kurbel.del()
          .lin({x1:0, y1:0, x2:mec.A.x, y2:mec.A.y, lw:3})
          .nod(mec.A);

    // inkrementiert phi
    if (run) {
        if (Drehrichtung.checked) {
            phi -= speedmod*pi/180;
        } else {
            phi += speedmod*pi/180;
        }
    }
}

function render() {
    position();  // aktualisiere Position
    world.exe(ctx);  // rendert world in den Context
    requestAnimationFrame(render);  // asynchroner callback von render(), keine Rekursion!
}

// wechselt Status der Lauferlaubnis
function startstop() {
    if (run) {
        run = false;
    } else {
        run = true;
    }
}

function changeSpeed() {
    // weist dem speedmodifier den Wert der ausgewaehlten Option zu
    speedmod = speed.options[speed.selectedIndex].value;
    // aktualisiert den Output
    Periodendauer.innerHTML = "T: " + 6/speedmod + "s";
}

function setl() {
        l = +lslider.value;
        lout.innerHTML = lslider.value;
}


/*
 *  Initialisierung
 */

// Eventlistener hinzufuegen
b.addEventListener("click",startstop);
speed.addEventListener("change",changeSpeed);
lslider.addEventListener("input",setl);

// Animation starten
render();

    </script>
</body>
</html>