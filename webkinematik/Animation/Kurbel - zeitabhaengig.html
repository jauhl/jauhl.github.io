<!doctype html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Kurbel</title>
</head>

<body>
    <h2>Kurbel</h2>
    <canvas id="c" width="300" height="300" style="border-width:1px;border-style:solid"></canvas>

    <script src="https://gitcdn.xyz/repo/goessner/g2/master/src/g2.js"></script>

    <script>

let cnv = document.getElementById('c'),
    ctx = cnv.getContext('2d'),

    pi = Math.PI,
    l = 100,  // Laenge der Kurbel

    phi = 0,  // Laufvariable

    T = 6,  // Periodendauer
    omega = 2*pi/T,  // Winkelgeschwindigkeit

    t0 = false,  // Startzeit

    mec = {
        get ephi() { return {x:Math.cos(phi), y:Math.sin(phi)}; },
        get A() { return {x:l*this.ephi.x, y:l*this.ephi.y}; }
    },

    // definiert Kurbel als g2() Objekt
    Kurbel = g2(),

    // baut und initialisiert statische Umgebung
    world = g2().clr()                                  // leert das Canvas
                .view({x:150,y:150,cartesian:true})     // schaltet kartesische Koordinaten ein & verschiebt den Nullpunkt
                .use({grp:Kurbel})                      // referenziert dynamisches Kurbel-Objekt
                .nodfix()                               // statisches Festlager im Ursprung
    ;

function position(t) {
    // aktualisiet phi
    phi = omega*t;

    // baut dynamische Kurbel auf
    Kurbel.del()
          .lin({x1:0, y1:0, x2:mec.A.x, y2:mec.A.y, lw:3})
          .nod(mec.A);
}

function render(time) {
    // initialisiert Startzeit falls das noch nicht passiert ist
    if (!t0)
        t0 = time;

    // aktualisiere Position mit übernahme der mom. Animationszeit
    position((time-t0)/1000);

    // rendert world in den Context
    world.exe(ctx);

    // asynchroner callback von render()
    requestAnimationFrame(render);
}

// startet die Animation die anschließend über callbacks weiterläuft
render();

    </script>
</body>
</html>